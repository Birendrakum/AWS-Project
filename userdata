# Install git and clone your project
sudo yum install git -y
sudo -u ec2-user git clone -b master --single-branch https://github.com/Birendrakum/AWS-Project.git

#Install python3, django and other dependencies
sudo yum install python3 python3-pip -y
pip install django boto3 django-storages[boto3]

#Install nginx
sudo yum install nginx -y

#Go to AWS-project
cd AWS-Project/

# open django.conf file and in server_name give ur ec2 public ip
PUBLIC_IP=$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4)
sudo sed -i "s/server_name .*;/server_name $PUBLIC_IP;/g" /home/ec2-user/AWS-Project/django.conf

#copy django.conf inside AWS-Project directory to /etc/nginx/conf.d
cp ./django.conf /etc/nginx/conf.d

#Restart nginx
sudo systemctl restart nginx

# Add your access key, secret key, bucket name and region in settings.py file
cd webpage_code/
sudo nano ./myproject/settings.py
SECRET_JSON=$(aws secretsmanager get-secret-value --secret-id "secret1" --query "SecretString" --output text)
ACCESS_KEY=$(echo $SECRET_JSON | jq -r '.Access_key')
SECRET_KEY=$(echo $SECRET_JSON | jq -r '.Secret_key')
sudo sed -i "s/AWS_ACCESS_KEY_ID .*;/AWS_ACCESS_KEY_ID = '$access_key';/g" /home/ec2-user/AWS-Project/Webpage_code/myproject/settings.py
sudo sed -i "AWS_SECRET_ACCESS_KEY .*;/AWS_SECRET_ACCESS_KEY = '$secret_key';/g" /home/ec2-user/AWS-Project/Webpage_code/myproject/settings.py

# start django server
python3 manage.py makemigrations
python3 manage.py migrate
python3 manage.py runserver

#Access ur website
Copy the public ip of your ec2 and access it in incognito mode
